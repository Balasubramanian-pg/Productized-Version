Here's a comprehensive articulation of the business logic and assumptions underpinning the inventory metrics demo dataset:

---

### **Business Logic Framework**

#### **1. Core Inventory Metrics Calculation**
**a) Inventory Turnover**
```math
\text{Inventory Turnover} = \frac{\text{Cost of Goods Sold (COGS)}}{\text{Average Inventory Value}}
```
- **COGS Calculation**: 
  - Captured via goods issue movements (SAP movement types 261, 262)
  - Uses standard price from MBEW for valuation consistency
  - Excludes internal transfers and non-sales movements
- **Average Inventory**:
  - Monthly average of (unrestricted stock × standard price)
  - Considers all storage locations per plant-material combo

**b) Fill Rate**
```math
\text{Fill Rate} = \frac{\text{Orders Filled Completely}}{\text{Total Orders}} \times 100
```
- **Complete Fulfillment Criteria**:
  - LIPS delivery status = 'A' (completed)
  - Delivered quantity ≥ ordered quantity (VBAP vs LIPS)
  - No subsequent backorders in VBFA (VBTYP_N ≠ 'N')

**c) Days of Supply**
```math
\text{Days of Supply} = \frac{\text{Current Inventory}}{\text{Average Daily Demand}}
```
- **Demand Baseline**:
  - Primary: Actual sales orders (VBAP-KWMENG)
  - Fallback: Safety stock (MARD-EISBE) when order history < 30 days
- **Inventory Basis**: Unrestricted stock (MARD-LABST)

---

### **Key Business Assumptions**

#### **1. Material Valuation**
- Standard price (MBEW-STPRS) used for all inventory valuation
- Moving average price (MBEW-VERPR) varies ±5% from standard
- Price unit consistently = 1 (no quantity-based pricing)

#### **2. Transaction Patterns**
**a) Seasonality**
```python
# Q4 peak (+30% volume)
if month in [10,11,12]: 
    base_volume *= 1.3
    
# Summer slowdown (-20% July-August) 
elif month in [7,8]:
    base_volume *= 0.8
```

**b) Order Fulfillment**
| Status | Probability | Business Meaning |
|--------|-------------|-------------------|
| 'A' (Complete) | 80% | Full delivery |
| 'B' (Partial) | 15% | 30-70% delivered |
| 'C' (Backordered) | 5% | 0% delivered |

**c) Movement Types**
| SAP Code | Frequency | Business Process |
|----------|-----------|------------------|
| 101 (GR) | 15/day | Production receipts |
| 261 (GI) | 20/day | Sales fulfillment |
| 201 (GI) | 5/day | Internal consumption |
| 521 (TP) | 3/day | Location transfers |

#### **3. Data Quality Rules**
- **Referential Integrity**: 
  - 100% valid plant-material combinations
  - No orphaned documents in VBFA
- **Null Values**:
  - 5% of MSEG batch numbers null (emergency receipts)
  - 3% storage locations missing (system entry errors)
- **Value Boundaries**:
  ```python
  # Inventory constraints
  assert mard.unrestricted_stock.min() >= 0
  assert mseg[mseg.movement_type=='261'].quantity.max() <= 50
  ```

---

### **Industry-Specific Adjustments**

#### **For Manufacturing**
- Added 10% yield loss in production receipts:
  ```python
  if movement_type == '101':
      actual_qty = round(order_qty * random.uniform(0.9, 1.0))
  ```
- Safety stock = 20% of average monthly demand

#### **For Retail**
- 15% higher inventory turnover (6.5 vs 5.0)
- Weekend deliveries enabled (+25% Saturday volume)

---

### **Temporal Logic**

#### **1. Fiscal Calendar**
```python
# Configurable fiscal year start
FISCAL_START_MONTH = 4  # April for EU companies

def get_fiscal_period(date):
    fiscal_month = (date.month - FISCAL_START_MONTH) % 12 + 1
    fiscal_year = date.year if date.month >= FISCAL_START_MONTH else date.year - 1
    return f"FY{fiscal_year}-{fiscal_month:02d}"
```

#### **2. Lead Time Simulation**
```python
# Order-to-delivery timeline
ORDER_LEAD_TIME = {
    'standard': timedelta(days=3),
    'express': timedelta(days=1),
    'backorder': timedelta(days=14)
}
```

---

### **Validation Checks**

| Test Category | Validation Rule | Tolerance |
|---------------|-----------------|-----------|
| Financial | COGS ≤ Revenue | 100% |
| Operational | Fill Rate ≤ 100% | 100% |
| Temporal | No future-dated docs | 100% |
| Relational | All VBAP have VBAK | 100% |
| Statistical | Turnover 4-8 (manufacturing) | ±15% |

---

### **Rationale for Key Decisions**

1. **Why Standard Price?**
   - Eliminates noise from price fluctuations in demo data
   - Matches SAP's default inventory reporting approach

2. **Partial Delivery Logic**
   - Simulates real-world supply chain disruptions
   - Enables backorder scenario analysis

3. **Weekday-Only Transactions**
   - Reflects B2B manufacturing patterns
   - Can be disabled for retail scenarios

4. **Two-Year Horizon**
   - Shows annual seasonality patterns
   - Allows meaningful trend analysis

---

This framework ensures the demo data:
- Passes basic sanity checks
- Shows realistic volatility
- Supports drill-down analysis
- Maintains SAP-specific business rules
- Delivers actionable insights at executive level
